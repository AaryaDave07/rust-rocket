# rust-rocket

Simple REST API in **Rust** using **Rocket** + **Diesel (SQLite)**. It models a small delivery system with six entities:

* Riders
* Shops
* Items
* Buyers
* Orders
* Payments

This starter currently ships with fully working **Riders** CRUDL endpoints. The database schema/migrations include all six tables so you can extend the remaining endpoints later.

---

## What you can do right now

* Start the server locally
* Create, Read, Update, Delete, and List **riders** in a SQLite database
* See how routes, models, and Diesel queries are wired together

> ⚠️ This is a **learning/demo** project. No authentication, no validation, and no production hardening.

---

## Prerequisites (Windows friendly)

1. **Rust** (includes `cargo`): [https://rustup.rs](https://rustup.rs)
2. **Visual Studio Build Tools** (C++ workload) – needed for compiling dependencies.
3. **Diesel CLI** (with SQLite bundled)

   ```powershell
   cargo install diesel_cli --no-default-features --features sqlite-bundled
   ```

> This project uses the `bundled` SQLite feature so you **don’t** need to install SQLite separately.

---

## Project structure

```
rust-rocket/
├─ Cargo.toml
├─ Rocket.toml
├─ .env
├─ db/                 # (ignored) SQLite database file lives here
├─ migrations/         # Diesel migrations for all 6 tables
│  └─ 2024-01-01-000000_create_initial_schema/
│     ├─ up.sql
│     └─ down.sql
└─ src/
   ├─ main.rs          # Rocket server with /riders routes
   ├─ models.rs        # Data models (Rider/NewRider etc.)
   └─ schema.rs        # Auto-generated by Diesel (don’t edit manually)
```

---

## Configure

1. Create a `.env` file in the project root with the database path:

   ```dotenv
   DATABASE_URL=db/rust-rocket.db
   ```

2. (Optional) Adjust `Rocket.toml` for port or log level.

---

## Set up the database

1. Create the `db` folder if missing:

   ```powershell
   New-Item -ItemType Directory -Force db | Out-Null
   ```
2. Run Diesel migrations (creates tables):

   ```powershell
   diesel migration run
   ```
3. (If you change the schema later) regenerate `src/schema.rs`:

   ```powershell
   diesel print-schema | Out-File -FilePath src/schema.rs -Encoding utf8
   ```

---

## Run the server

```powershell
cargo run
```

You should see output ending with something like:

```
Rocket has launched from http://127.0.0.1:8000
```

---

## API – Riders (CRUDL)

**Base URL:** `http://127.0.0.1:8000`

### List riders

* **GET** `/riders`
* Example (browser): open `http://127.0.0.1:8000/riders`

### Create rider

* **POST** `/riders`
* JSON body:

  ```json
  {"name": "John Doe", "phone": "9876543210"}
  ```
* Example (PowerShell):

  ```powershell
  Invoke-WebRequest -Uri "http://127.0.0.1:8000/riders" `
    -Method POST `
    -Headers @{ "Content-Type" = "application/json" } `
    -Body '{"name": "John Doe", "phone": "9876543210"}'
  ```

### Get one rider

* **GET** `/riders/<id>`
* Example:

  ```powershell
  (Invoke-WebRequest -Uri "http://127.0.0.1:8000/riders/1" -Method GET).Content
  ```

### Update rider

* **PUT** `/riders/<id>`
* JSON body:

  ```json
  {"name": "Johnny Updated", "phone": "9999999999"}
  ```
* Example:

  ```powershell
  Invoke-WebRequest -Uri "http://127.0.0.1:8000/riders/1" `
    -Method PUT `
    -Headers @{ "Content-Type" = "application/json" } `
    -Body '{"name": "Johnny Updated", "phone": "9999999999"}'
  ```

### Delete rider

* **DELETE** `/riders/<id>`
* Example:

  ```powershell
  Invoke-WebRequest -Uri "http://127.0.0.1:8000/riders/1" -Method DELETE
  ```

---

## How to extend to Buyers/Shops/Items/Orders/Payments

1. **Add models** to `models.rs` (`Queryable`, `Insertable` etc.) for each table.
2. **Create routes** in `main.rs` for each resource (copy the riders pattern).
3. Use Diesel’s `insert_into`, `update`, `delete`, and queries to implement CRUDL.
4. Re-run `diesel print-schema` if you update migrations.

> Tip: Start with **Buyers** (similar to Riders: `name`, `address`), then **Shops**, **Items**, and finally connect **Orders** and **Payments** using foreign keys.

---

## Troubleshooting

**Linker error on Windows: `fatal error LNK1181: cannot open input file 'sqlite3.lib'`**

* This project uses `libsqlite3-sys` with the `bundled` feature to avoid that error. If you change dependencies, keep the bundled feature enabled or install system SQLite dev libs.

**Schema changes not reflected**

* Re-run migrations and regenerate schema:

  ```powershell
  diesel migration redo
  diesel print-schema | Out-File -FilePath src/schema.rs -Encoding utf8
  ```

---

## .gitignore (suggested)

```
/target/
/db/
*.db
*.sqlite
.env
.DS_Store
Thumbs.db
```

---

## License

MIT (do whatever you like, attribution appreciated)
